<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ† DAON 2025: GRAND FINALE ğŸ†</title>
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.0/kakao.min.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    
    <style>
        /* [DESIGN SYSTEM] */
        :root {
            --glass: rgba(255, 255, 255, 0.1);
            --border: rgba(255, 255, 255, 0.2);
            --gold: #FFD700;
            --daon-pink: #ff00d4;
            --hope-cyan: #00ffff;
            --sos-red: #ff3b30;
        }

        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; color: #fff; font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif; overflow: hidden; touch-action: manipulation; }

        /* [1] ìº”ë²„ìŠ¤ & ì˜¤ë²„ë ˆì´ */
        #fireworksCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; }
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle, transparent 30%, rgba(0,0,0,0.8) 100%); z-index: 2; pointer-events: none; }
        
        #rec-indicator { display: none; position: fixed; top: 80px; right: 20px; color: #ff0000; font-weight: 900; z-index: 3000; font-size: 14px; animation: blink 1s infinite; text-shadow: 0 0 10px red; }
        @keyframes blink { 50% { opacity: 0; } }

        /* [2] ìƒë‹¨ í—¤ë” ì˜ì—­ (ìŠ¬ë¡œê±´ + ë°°ë„ˆ) */
        #header-container { position: fixed; top: 0; width: 100%; z-index: 100; display: flex; flex-direction: column; background: rgba(0,0,0,0.3); backdrop-filter: blur(5px); }
        
        #top-bar { display: flex; justify-content: space-between; padding: 10px 15px; }
        
        /* ìŠ¬ë¡œê±´ ìŠ¤íƒ€ì¼ */
        #project-info { transform-origin: top left; }
        .slogan-text { font-size: 13px; color: var(--gold); font-weight: bold; margin-bottom: 3px; letter-spacing: -0.5px; animation: glow 2s infinite alternate; }
        .title-text { font-size: 16px; font-weight: 800; letter-spacing: 1px; color: var(--hope-cyan); text-shadow: 0 0 15px var(--hope-cyan); }
        @keyframes glow { from { text-shadow: 0 0 5px var(--gold); } to { text-shadow: 0 0 15px var(--gold), 0 0 5px #fff; } }

        /* ë°°ë„ˆ ê´‘ê³  ìŠ¤íƒ€ì¼ */
        #ad-banner { 
            width: 100%; height: 32px; 
            background: linear-gradient(90deg, rgba(255,0,212,0.2), rgba(0,255,255,0.2));
            border-top: 1px solid rgba(255,255,255,0.1);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex; align-items: center; justify-content: center;
            font-size: 12px; color: #fff; cursor: pointer; overflow: hidden;
        }
        .marquee { white-space: nowrap; animation: slide 15s linear infinite; font-weight: bold; }
        @keyframes slide { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }

        /* [3] ìš°ì¸¡ ë„¤ë¹„ê²Œì´ì…˜ */
        #right-nav { position: fixed; right: 15px; top: 50%; transform: translateY(-50%); display: flex; flex-direction: column; gap: 15px; z-index: 1000; }
        .nav-btn { width: 45px; height: 45px; border-radius: 50%; border: 1px solid var(--border); background: rgba(0,0,0,0.5); backdrop-filter: blur(10px); color: #fff; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center; transition: 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .nav-btn:hover { transform: scale(1.15); background: var(--hope-cyan); color: #000; border-color: var(--hope-cyan); }
        .nav-btn.sos { border-color: var(--sos-red); color: var(--sos-red); }

        /* [4] ìŠ¬ë¼ì´ë”© ì„œë */
        .drawer { position: fixed; right: -100%; top: 0; width: 85%; max-width: 360px; height: 100%; background: rgba(10, 10, 10, 0.95); backdrop-filter: blur(30px); z-index: 2000; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); padding: 25px; border-left: 1px solid var(--border); box-sizing: border-box; overflow-y: auto; display: flex; flex-direction: column; }
        .drawer.active { right: 0; }
        .drawer-header { font-size: 18px; font-weight: bold; color: var(--hope-cyan); margin-bottom: 20px; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid var(--border); padding-bottom: 15px; }
        .close-btn { margin-top: auto; padding: 15px; background: rgba(255,255,255,0.1); border: 1px solid var(--border); color: #fff; border-radius: 12px; cursor: pointer; font-weight: bold; }
        
        .card { background: var(--glass); padding: 15px; border-radius: 12px; margin-bottom: 12px; border: 1px solid var(--border); }
        .action-btn { width: 100%; padding: 14px; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; border: none; font-size: 14px; transition: 0.2s; }
        .btn-neon { background: var(--daon-pink); color: #fff; box-shadow: 0 0 15px var(--daon-pink); }
        
        /* [5] í•˜ë‹¨ ì»¨íŠ¸ë¡¤ */
        #ui-panel { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 400px; z-index: 1000; }
        .input-box { display: flex; gap: 10px; margin-bottom: 10px; background: rgba(0,0,0,0.6); padding: 5px; border-radius: 15px; border: 1px solid var(--border); backdrop-filter: blur(10px); }
        input { flex: 1; background: transparent; border: none; padding: 12px; color: #fff; font-size: 14px; outline: none; }
        .btn-group { display: flex; gap: 10px; }
        #launch-btn { flex: 2; padding: 16px; border-radius: 15px; border: none; background: var(--hope-cyan); color: #000; font-weight: 900; cursor: pointer; font-size: 16px; box-shadow: 0 5px 20px rgba(0,255,255,0.3); }
        #video-btn { flex: 1; padding: 16px; border-radius: 15px; border: none; background: #333; color: #fff; font-weight: bold; cursor: pointer; border: 1px solid var(--border); }

        #watermark { position: fixed; bottom: 10px; right: 15px; font-size: 10px; opacity: 0.5; z-index: 100; letter-spacing: 1px; font-family: monospace; }
    </style>
</head>
<body>

    <canvas id="fireworksCanvas"></canvas>
    <div id="overlay"></div>
    <div id="rec-indicator">â— REC</div>

    <div id="header-container">
        <div id="top-bar">
            <div id="project-info">
                <div class="slogan-text">"ì§„ì‹¬ì€ í†µí•œë‹¤ í–‰ë³µì„ ì´ë¼"</div>
                <div class="title-text">DAON 2025 FINALE</div>
            </div>
            <div style="font-size: 20px;" onclick="window.open('https://youtube.com/@Da-OnOfficial')">ğŸ“º</div>
        </div>
        
        <div id="ad-banner" onclick="window.open('https://www.youtube.com/@Da-OnOfficial')">
            <div class="marquee">ğŸ“¢ [DAON OFFICIAL] ë‹¤ì˜¨ì´ì˜ ìƒˆë¡œìš´ ì˜ìƒì´ ë„ì°©í–ˆìŠµë‹ˆë‹¤! í´ë¦­í•´ì„œ êµ¬ë…ê³¼ ì¢‹ì•„ìš” ë¶€íƒë“œë ¤ìš”! ğŸ’– ì§„ì‹¬ì€ í†µí•œë‹¤!</div>
        </div>
    </div>

    <div id="right-nav">
        <button class="nav-btn" onclick="openDrawer('music')" title="ìŒì•… & ì±„ë„">ğŸµ</button>
        <button class="nav-btn" onclick="openDrawer('meal')" title="ë°€í”„ë©">ğŸ¥—</button>
        <button class="nav-btn" onclick="openDrawer('donate')" title="í›„ì›">â˜•</button>
        <button class="nav-btn sos" onclick="openDrawer('sos')" title="SOS">ğŸš¨</button>
    </div>

    <div id="music" class="drawer">
        <div class="drawer-header">ğŸµ MUSIC & CHANNEL</div>
        
        <button class="action-btn btn-neon" onclick="window.open('https://www.youtube.com/@Da-OnOfficial')">
            ğŸ“º ë‹¤ì˜¨ ìœ íŠœë¸Œ ì±„ë„ ë°”ë¡œê°€ê¸°
        </button>
        <div style="font-size:11px; text-align:center; margin:10px 0 20px 0; color:#ccc;">
            â–² ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì±„ë„ë¡œ ì´ë™í•©ë‹ˆë‹¤
        </div>

        <div class="card" style="height: 200px; padding: 0; overflow: hidden;">
            <div id="player"></div>
        </div>
        <button class="action-btn" style="background:#ff0000; color:#fff;" onclick="playBGM()">â–¶ ë°°ê²½ìŒì•… ì¬ìƒ (BGM)</button>
        
        <button class="close-btn" onclick="closeDrawer()">ë‹«ê¸°</button>
    </div>

    <div id="meal" class="drawer">
        <div class="drawer-header">ğŸ¥— MUSICAL MEAL PREP</div>
        <div class="card">
            <p style="font-size:12px; color:#aaa; margin-top:0;">ì˜¤ëŠ˜ì˜ ì‹ë‹¨ì„ ê¸°ë¡í•´ë³´ì„¸ìš”.</p>
            <input type="text" id="meal-input" placeholder="ì˜ˆ: ë‹­ê°€ìŠ´ì‚´ ìƒëŸ¬ë“œ, ë”¸ê¸°" style="width:100%; background:rgba(255,255,255,0.1); border:1px solid #555; padding:10px; color:#fff; border-radius:8px; box-sizing:border-box;">
            <button class="action-btn" style="background:var(--hope-cyan); color:#000;" onclick="addMeal()">ê¸°ë¡í•˜ê¸°</button>
        </div>
        <button class="action-btn btn-neon" onclick="playMealShow()">âœ¨ ë‚´ ì‹ë‹¨ ë¶ˆê½ƒì‡¼ ë³´ê¸°</button>
        <div style="font-size:11px; text-align:center; margin-top:5px; opacity:0.7;">ì‹ë‹¨ ë°ì´í„°ê°€ ì•„ë¦„ë‹¤ìš´ ë¶ˆê½ƒìœ¼ë¡œ ë³€í•©ë‹ˆë‹¤!</div>

        <div id="meal-list" style="margin-top:20px;"></div>
        <button class="close-btn" onclick="closeDrawer()">ë‹«ê¸°</button>
    </div>

    <div id="donate" class="drawer">
        <div class="drawer-header">â˜• SUPPORT DAON</div>
        <div class="card" style="text-align: center;">
            <p>ë‹¤ì˜¨ì´ì˜ ê¿ˆì´ ê³„ì†ë  ìˆ˜ ìˆë„ë¡<br>ë”°ëœ»í•œ ì»¤í”¼ í•œ ì”ì„ ì„ ë¬¼í•´ì£¼ì„¸ìš”.</p>
            <div style="font-size:40px; margin:15px;">â˜•</div>
            <button class="action-btn" style="background:var(--gold); color:#000;" onclick="window.open('https://toss.me/daon-official')">Tossë¡œ í›„ì›í•˜ê¸°</button>
        </div>
        <button class="close-btn" onclick="closeDrawer()">ë‹«ê¸°</button>
    </div>

    <div id="sos" class="drawer">
        <div class="drawer-header" style="color:var(--sos-red);">ğŸš¨ EMERGENCY</div>
        <button class="action-btn" style="background:var(--sos-red); color:#fff; font-size:18px;" onclick="location.href='tel:112'">ğŸ“ 112 (ê²½ì°°)</button>
        <button class="action-btn" style="background:#ff9500; color:#fff; font-size:18px;" onclick="location.href='tel:119'">ğŸ“ 119 (êµ¬ê¸‰)</button>
        <button class="close-btn" onclick="closeDrawer()">ë‹«ê¸°</button>
    </div>

    <div id="ui-panel">
        <div class="input-box">
            <input type="text" id="user-msg" placeholder="ë°¤í•˜ëŠ˜ì— ë„ìš¸ í–‰ë³µ ë©”ì‹œì§€...">
        </div>
        <div class="btn-group">
            <button id="launch-btn" onclick="launchCustomRocket()">ğŸš€ ì˜ì•„ì˜¬ë¦¬ê¸°</button>
            <button id="video-btn" onclick="recordVideo()">ğŸ¬ ì˜ìƒ ì†Œì¥</button>
        </div>
    </div>

    <div id="watermark">v.251228 FINAL_UPDATED | Â© 2025 DAON OFFICIAL</div>

    <script>
        // [0] ì´ˆê¸°í™”
        const KAKAO_KEY = 'fa462b2b643a16d837c1890cc3dc4149'; 
        try { if (!Kakao.isInitialized()) Kakao.init(KAKAO_KEY); } catch(e) {}

        const canvas = document.getElementById('fireworksCanvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        let rockets = [];

        // [1] ìœ íŠœë¸Œ API
        let player;
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '100%', width: '100%', videoId: 'WPfyXfdrCqs',
                playerVars: { 'autoplay': 0, 'controls': 1, 'rel': 0 }
            });
        }
        function playBGM() { if(player) player.playVideo(); }

        // [2] ë¶ˆê½ƒë†€ì´ ì—”ì§„
        class Rocket {
            constructor(x, y, targetY, color, text = null, special = false) {
                this.x = x; this.y = y; this.targetY = targetY;
                this.color = color; this.text = text; this.special = special;
                this.vy = -12; this.alive = true;
            }
            update() {
                this.y += this.vy;
                if (this.y <= this.targetY) { this.alive = false; this.explode(); }
            }
            draw() {
                ctx.beginPath(); ctx.arc(this.x, this.y, 3, 0, Math.PI*2);
                ctx.fillStyle = this.color; ctx.fill();
            }
            explode() {
                const count = this.special ? 80 : 50;
                for(let i=0; i<count; i++) particles.push(new Particle(this.x, this.y, this.color));
                // í…ìŠ¤íŠ¸ê°€ ìˆìœ¼ë©´ í…ìŠ¤íŠ¸ ì…ì ìƒì„±
                if(this.text) particles.push(new TextParticle(this.x, this.y, this.text, this.color));
            }
        }

        class Particle {
            constructor(x, y, color) {
                this.x = x; this.y = y; this.color = color;
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 5 + 2;
                this.vx = Math.cos(angle) * speed; this.vy = Math.sin(angle) * speed;
                this.alpha = 1; this.friction = 0.95; this.gravity = 0.15;
            }
            update() {
                this.vx *= this.friction; this.vy *= this.friction; this.vy += this.gravity;
                this.x += this.vx; this.y += this.vy; this.alpha -= 0.015;
            }
            draw() {
                ctx.globalAlpha = this.alpha;
                ctx.beginPath(); ctx.arc(this.x, this.y, 2, 0, Math.PI*2);
                ctx.fillStyle = this.color; ctx.fill();
                ctx.globalAlpha = 1;
            }
        }

        // [í•µì‹¬] 30ì´ˆ ë™ì•ˆ ìœ ì§€ë˜ëŠ” í…ìŠ¤íŠ¸ ì…ì í´ë˜ìŠ¤
        class TextParticle {
            constructor(x, y, text, color) {
                this.x = x; this.y = y; this.text = text; this.color = color;
                this.alpha = 1; 
                // 60fps * 30ì´ˆ = 1800 í”„ë ˆì„ ìˆ˜ëª…
                this.life = 1800; 
            }
            update() { 
                this.life--; 
                // ë§ˆì§€ë§‰ 2ì´ˆ(120í”„ë ˆì„) ë™ì•ˆë§Œ ì„œì„œíˆ ì‚¬ë¼ì§
                if(this.life < 120) this.alpha -= 0.01; 
            }
            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.fillStyle = "#fff";
                ctx.font = "bold 32px Pretendard, sans-serif";
                ctx.textAlign = "center";
                ctx.shadowColor = this.color; ctx.shadowBlur = 20;
                // ë°°ë„ˆ ë°”ë¡œ ì•„ë˜ì— ê³ ì •ì ìœ¼ë¡œ í…ìŠ¤íŠ¸ í‘œì‹œ
                ctx.fillText(this.text, this.x, this.y);
                ctx.restore();
            }
        }

        function animate() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            rockets.forEach((r, i) => { r.update(); r.draw(); if(!r.alive) rockets.splice(i, 1); });
            particles.forEach((p, i) => { p.update(); p.draw(); if(p.alpha <= 0 || (p.life && p.life<=0)) particles.splice(i, 1); });
            requestAnimationFrame(animate);
        }

        // [3] ë¡œì§ í•¨ìˆ˜ë“¤
        function launchCustomRocket() {
            const input = document.getElementById('user-msg');
            const msg = input.value || "DAON 2025";
            const color = `hsl(${Math.random()*360}, 100%, 70%)`;
            
            // ë°°ë„ˆ(ìƒë‹¨ 100px ì •ë„) ë°”ë¡œ ë°‘ì—ì„œ í„°ì§€ë„ë¡ ì¢Œí‘œ ì„¤ì • (í™”ë©´ ë†’ì´ì˜ 20%)
            const targetY = canvas.height * 0.2;
            
            rockets.push(new Rocket(canvas.width/2, canvas.height, targetY, color, msg, true));
            input.value = "";
            
            const btn = document.getElementById('launch-btn');
            if(btn.innerText.includes("ì˜ì•„ì˜¬ë¦¬ê¸°")) {
                setTimeout(() => {
                    btn.innerText = "ì¹´í†¡ìœ¼ë¡œ ìë‘í•˜ê¸°";
                    btn.style.background = "var(--daon-pink)";
                    btn.onclick = () => shareKakao(msg);
                }, 2000);
            }
        }

        function addMeal() {
            const input = document.getElementById('meal-input');
            if(!input.value) return;
            const meals = JSON.parse(localStorage.getItem('daon_meals') || '[]');
            meals.unshift({ t: input.value, d: new Date().toLocaleDateString() });
            localStorage.setItem('daon_meals', JSON.stringify(meals));
            renderMeals(); input.value = '';
        }
        
        function renderMeals() {
            const list = document.getElementById('meal-list');
            const meals = JSON.parse(localStorage.getItem('daon_meals') || '[]');
            list.innerHTML = meals.slice(0, 5).map(m => `
                <div class="card" style="padding:10px; margin-bottom:5px; border-left:3px solid ${getMealColor(m.t)}">
                    <span style="font-size:10px; opacity:0.6">${m.d}</span><br>${m.t}
                </div>`).join('');
        }

        function getMealColor(text) {
            if(text.includes('ë”¸ê¸°') || text.includes('ê³ ê¸°')) return '#ff4d4d';
            if(text.includes('ìƒëŸ¬ë“œ') || text.includes('ì±„ì†Œ')) return '#2ecc71';
            return '#00ffff';
        }

        function playMealShow() {
            const meals = JSON.parse(localStorage.getItem('daon_meals') || '[]');
            if(!meals.length) return alert("ì €ì¥ëœ ì‹ë‹¨ì´ ì—†ìŠµë‹ˆë‹¤!");
            closeDrawer();
            alert("ì‹ë‹¨ ë¶ˆê½ƒì‡¼ê°€ ì‹œì‘ë©ë‹ˆë‹¤! ğŸ¥—ğŸ†");
            meals.slice(0,5).forEach((m, i) => {
                setTimeout(() => {
                    const x = canvas.width * 0.2 + Math.random() * canvas.width * 0.6;
                    rockets.push(new Rocket(x, canvas.height, canvas.height * (0.2 + Math.random()*0.3), getMealColor(m.t), m.t, true));
                }, i * 1500);
            });
        }

        async function recordVideo() {
            if(!confirm("6ì´ˆ ë™ì•ˆ í™”ë©´ì„ ë…¹í™”í•˜ì—¬ ë‹¤ìš´ë¡œë“œí•©ë‹ˆë‹¤. ì‹œì‘í• ê¹Œìš”?")) return;
            try {
                const stream = canvas.captureStream(30);
                const recorder = new MediaRecorder(stream, { mimeType: 'video/webm' });
                const chunks = [];
                document.getElementById('rec-indicator').style.display = 'block';
                recorder.ondataavailable = e => { if(e.data.size > 0) chunks.push(e.data); };
                recorder.onstop = () => {
                    const blob = new Blob(chunks, { type: 'video/webm' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url; a.download = `DAON_251228_FINALE.webm`;
                    a.click();
                    document.getElementById('rec-indicator').style.display = 'none';
                    alert("ì˜ìƒì´ ê°¤ëŸ¬ë¦¬ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
                };
                recorder.start();
                rockets.push(new Rocket(canvas.width/2, canvas.height, canvas.height*0.2, "#ff00d4", "VIDEO RECORDING", true));
                setTimeout(() => recorder.stop(), 6000);
            } catch(e) { alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ë…¹í™”ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."); }
        }

        function shareKakao(msg) {
            Kakao.Share.sendDefault({
                objectType: 'text',
                text: `[ë‹¤ì˜¨ í”„ë¡œì íŠ¸] ë©”ì‹œì§€:\n"${msg}"\n\nì§„ì‹¬ì€ í†µí•œë‹¤, í–‰ë³µì„ ì´ë¼!`,
                link: { mobileWebUrl: window.location.href, webUrl: window.location.href },
            });
        }

        function openDrawer(id) {
            document.querySelectorAll('.drawer').forEach(d => d.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'meal') renderMeals();
        }
        function closeDrawer() { document.querySelectorAll('.drawer').forEach(d => d.classList.remove('active')); }

        window.onload = () => {
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            animate();
            setInterval(() => {
                rockets.push(new Rocket(Math.random()*canvas.width, canvas.height, canvas.height*0.2 + Math.random()*canvas.height*0.5, `hsl(${Math.random()*360}, 100%, 70%)`));
            }, 1800);
            setTimeout(() => rockets.push(new Rocket(canvas.width/2, canvas.height, canvas.height*0.4, "#FFD700", "ì§„ì‹¬ì€ í†µí•œë‹¤", true)), 2000);
            setTimeout(() => rockets.push(new Rocket(canvas.width/2, canvas.height, canvas.height*0.2, "#fff", "í–‰ë³µì„ ì´ë¼", true)), 4000);
        };
        window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
    </script>
</body>
</html>