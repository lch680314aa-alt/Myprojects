<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ† DAON 2025: GRAND FINALE ğŸ†</title>
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.0/kakao.min.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        :root {
            --glass: rgba(255, 255, 255, 0.08);
            --border: rgba(255, 255, 255, 0.15);
            --gold: #FFD700;
            --sos-red: #ff3b30;
            --accent: #00ffff;
            --neon-pink: #ff00d4;
            --youtube-red: #FF0000;
        }

        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; color: #fff; font-family: 'Pretendard', sans-serif; overflow: hidden; }

        /* [1] ë°°ê²½ ë ˆì´ì–´ */
        #fireworksCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; }
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle, transparent 20%, rgba(0,0,0,0.6) 90%); z-index: 2; pointer-events: none; }

        /* [2] ìƒë‹¨ ë ˆì´ì•„ì›ƒ */
        #top-bar { position: fixed; top: 0; width: 100%; display: flex; justify-content: space-between; padding: 8px 15px; z-index: 100; box-sizing: border-box; background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent); }
        #loyalty-zone { transform: scale(0.75); transform-origin: top left; }
        .slogan { font-size: 14px; font-weight: 800; letter-spacing: 1px; color: var(--accent); text-shadow: 0 0 10px var(--accent); }
        .count-badge { background: var(--accent); color: #000; padding: 2px 10px; border-radius: 20px; font-size: 12px; font-weight: bold; margin-top: 5px; display: inline-block; }
        #ad-banner { width: 45%; height: 35px; background: var(--glass); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 10px; border-radius: 5px; backdrop-filter: blur(5px); cursor: pointer; color: #fff; }

        /* [3] ìš°ì¸¡ ë„¤ë¹„ê²Œì´ì…˜ */
        #right-nav { position: fixed; right: 15px; top: 50%; transform: translateY(-50%); display: flex; flex-direction: column; gap: 10px; z-index: 1000; }
        .nav-circle { width: 42px; height: 42px; border-radius: 50%; border: 1px solid var(--border); background: var(--glass); backdrop-filter: blur(15px); color: #fff; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center; transition: all 0.3s; }
        .nav-circle:hover { transform: scale(1.1); background: var(--accent); color: #000; }

        /* [4] ì„œë ì‹œìŠ¤í…œ */
        .drawer { position: fixed; right: -100%; top: 0; width: 85%; max-width: 340px; height: 100%; background: rgba(0,0,0,0.95); backdrop-filter: blur(25px); z-index: 2000; transition: 0.4s ease-in-out; padding: 20px; border-left: 1px solid var(--border); box-sizing: border-box; overflow-y: auto; }
        .drawer.active { right: 0; }
        .drawer-close { cursor: pointer; float: right; font-size: 20px; color: #fff; }
        .menu-content { margin-top: 40px; }
        h3 { color: var(--accent); margin-bottom: 20px; }
        .item-card { background: var(--glass); padding: 15px; border-radius: 12px; margin-bottom: 10px; border: 1px solid var(--border); }
        
        #yt-player-wrapper { width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 12px; overflow: hidden; margin-bottom: 20px; border: 1px solid var(--border); }
        .action-btn-sm { width: 100%; padding: 12px; border-radius: 10px; font-weight: bold; cursor: pointer; margin-bottom: 8px; border: none; }

        /* [5] í•˜ë‹¨ ì»¨íŠ¸ë¡¤ íŒë„¬ */
        #ui-panel { position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 380px; z-index: 1000; }
        .input-group { display: flex; gap: 8px; margin-bottom: 12px; }
        input { flex: 1; background: rgba(0,0,0,0.7); border: 1px solid var(--border); padding: 14px; border-radius: 15px; color: #fff; outline: none; }
        #main-launch-btn { width: 100%; padding: 16px; border-radius: 15px; border: none; background: var(--accent); color: #000; font-weight: 900; cursor: pointer; transition: 0.3s; }

        #watermark { position: fixed; bottom: 8px; right: 12px; font-size: 9px; opacity: 0.4; z-index: 100; letter-spacing: 1px; }
    </style>
</head>
<body>

    <canvas id="fireworksCanvas"></canvas>
    <div id="overlay"></div>

    <div id="top-bar">
        <div id="loyalty-zone">
            <div class="slogan">ì§„ì‹¬ì€ í†µí•œë‹¤ í¬ë§ì„ ì´ë¼</div>
            <div style="font-size:12px; color:var(--gold);">RANK: <span id="rank-name">WHITE OPAL</span></div>
            <div class="count-badge">GIFT: <span id="gift-count">0</span>íšŒ</div>
        </div>
        <div id="ad-banner" onclick="window.open('https://www.youtube.com/@Da-OnOfficial', '_blank')">
            ğŸ“º DAON OFFICIAL YouTube
        </div>
    </div>

    <div id="right-nav">
        <button class="nav-circle" onclick="toggleDrawer('music-drawer')" title="ìŒì•…">ğŸµ</button>
        <button class="nav-circle" onclick="toggleDrawer('meal-drawer')" title="ë°€í”„ë ™">ğŸ¥—</button>
        <button class="nav-circle" onclick="toggleDrawer('vault-drawer')" title="ë³´ê´€í•¨">ğŸ“¦</button>
        <button class="nav-circle" onclick="toggleDrawer('donate-drawer')" title="í›„ì›">â˜•</button>
        <button class="nav-circle" style="background:var(--sos-red)" onclick="toggleDrawer('sos-drawer')" title="SOS">ğŸš¨</button>
    </div>

    <div id="music-drawer" class="drawer">
        <span class="drawer-close" onclick="toggleDrawer('music-drawer')">âœ•</span>
        <div class="menu-content">
            <h3>ğŸµ DAON PLAYER</h3>
            <div id="yt-player-wrapper"><div id="main-player"></div></div>
            <button class="action-btn-sm" style="background:var(--youtube-red); color:#fff;" onclick="playDaonSong('WPfyXfdrCqs')">â–¶ í…Œë§ˆê³¡ ì¬ìƒ</button>
            <button class="action-btn-sm" style="background:#444; color:#fff;" onclick="stopMusicAndClose()">â–  ë„ê¸° ë° ë‹«ê¸°</button>
        </div>
    </div>

    <div id="meal-drawer" class="drawer">
        <span class="drawer-close" onclick="toggleDrawer('meal-drawer')">âœ•</span>
        <div class="menu-content">
            <h3>ğŸ¥— MUSICAL DIET</h3>
            <div class="item-card">
                <input type="text" id="meal-input" placeholder="ì˜¤ëŠ˜ì˜ ì‹ë‹¨ì„ ê¸°ë¡í•˜ì„¸ìš”" style="width:100%; border-radius:8px; border:1px solid var(--border); background:rgba(0,0,0,0.5); color:#fff; padding:10px; box-sizing:border-box;">
                <button class="action-btn-sm" style="background:var(--accent); color:#000; margin-top:10px;" onclick="saveMeal()">ì‹ë‹¨ ì €ì¥í•˜ê¸°</button>
            </div>
            <div id="meal-list"></div>
        </div>
    </div>

    <div id="vault-drawer" class="drawer">
        <span class="drawer-close" onclick="toggleDrawer('vault-drawer')">âœ•</span>
        <div class="menu-content">
            <h3>ğŸ“¦ GIFT VAULT</h3>
            <div id="vault-list-container">ë³´ê´€ëœ ì„ ë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>
        </div>
    </div>

    <div id="donate-drawer" class="drawer">
        <span class="drawer-close" onclick="toggleDrawer('donate-drawer')">âœ•</span>
        <div class="menu-content" style="text-align: center;">
            <h3>â˜• BUY ME A COFFEE</h3>
            <div class="item-card">
                <p style="font-size: 14px; line-height: 1.6;">ë‹¤ì˜¨ì˜ ë¶ˆê½ƒì´ ë©ˆì¶”ì§€ ì•Šë„ë¡<br>ë”°ëœ»í•œ ì»¤í”¼ í•œ ì”ì„ í›„ì›í•´ ì£¼ì„¸ìš”.</p>
                <img src="https://cdn-icons-png.flaticon.com/512/924/924514.png" style="width:80px; margin: 20px 0;">
                <button class="action-btn-sm" style="background:var(--gold); color:#000;" onclick="window.open('https://toss.me/daon-official', '_blank')">ì»¤í”¼ í•œ ì” ì„ ë¬¼í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <div id="sos-drawer" class="drawer">
        <span class="drawer-close" onclick="toggleDrawer('sos-drawer')">âœ•</span>
        <div class="menu-content">
            <h3 style="color:var(--sos-red);">ğŸš¨ EMERGENCY SOS</h3>
            <div class="item-card">
                <p style="font-size: 13px; color: var(--sos-red); font-weight: bold;">[ê¸´ê¸‰ ìƒí™© ë„ì›€ë§]</p>
                <button class="action-btn-sm" style="background:#ff3b30; color:#fff;" onclick="window.location.href='tel:112'">ğŸ“ ê²½ì°°ì²­ (112) ì—°ê²°</button>
                <button class="action-btn-sm" style="background:#ff9500; color:#fff;" onclick="window.location.href='tel:119'">ğŸ“ ì†Œë°©ì²­ (119) ì—°ê²°</button>
            </div>
            <div class="item-card">
                <p style="font-size: 12px;">ë³´í˜¸ìì—ê²Œ í˜„ì¬ ìœ„ì¹˜ ì „ì†¡</p>
                <button class="action-btn-sm" style="background:var(--accent); color:#000;" onclick="startSafeReturn()">ğŸ›¡ï¸ ì•ˆì‹¬ ê·€ê°€ ì„œë¹„ìŠ¤ ì‹œì‘</button>
            </div>
        </div>
    </div>

    <div id="ui-panel">
        <div class="input-group">
            <input type="text" id="nickname" placeholder="NICKNAME">
            <input type="text" id="message" placeholder="MESSAGE">
        </div>
        <button id="main-launch-btn" onclick="handleLaunch()">LAUNCH (í­ì£½ ë°œì‚¬)</button>
    </div>

    <div id="watermark">Â© 2025 DAON OFFICIAL. FULL INTEGRATED SYSTEM.</div>

    <script>
        const KAKAO_KEY = 'fa462b2b643a16d837c1890cc3dc4149'; 
        if (!Kakao.isInitialized()) Kakao.init(KAKAO_KEY);

        // [1] ìœ íŠœë¸Œ ì œì–´
        let ytPlayer;
        function onYouTubeIframeAPIReady() {
            ytPlayer = new YT.Player('main-player', {
                height: '100%', width: '100%', videoId: 'WPfyXfdrCqs',
                playerVars: { 'autoplay': 0, 'controls': 1, 'rel': 0, 'modestbranding': 1 }
            });
        }
        function playDaonSong(id) { if (ytPlayer && ytPlayer.loadVideoById) { ytPlayer.loadVideoById(id); ytPlayer.playVideo(); } }
        function stopMusicAndClose() { if (ytPlayer && ytPlayer.stopVideo) ytPlayer.stopVideo(); toggleDrawer('music-drawer'); }

        // [2] í­ì£½ ë¬¼ë¦¬ ì—”ì§„ (ìƒëµ ì—†ì´ ìœ ì§€)
        const canvas = document.getElementById('fireworksCanvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        let rockets = [];

        class Rocket {
            constructor(x, y, targetY, color, message) {
                this.x = x; this.y = y; this.targetY = targetY;
                this.color = color; this.message = message;
                this.velocity = -12; this.alive = true;
            }
            update() {
                this.y += this.velocity;
                if (this.y <= this.targetY) { this.explode(); this.alive = false; }
            }
            draw() {
                ctx.beginPath(); ctx.arc(this.x, this.y, 2.5, 0, Math.PI * 2);
                ctx.fillStyle = this.color; ctx.fill();
            }
            explode() {
                for(let i = 0; i < 50; i++) particles.push(new Particle(this.x, this.y, this.color));
                if(this.message) particles.push(new Particle(this.x, this.y, this.color, this.message));
            }
        }

        class Particle {
            constructor(x, y, color, text = '') {
                this.x = x; this.y = y; this.color = color; this.text = text;
                const angle = Math.random() * Math.PI * 2;
                const force = Math.random() * (text ? 5 : 9) + 2;
                this.velocity = { x: Math.cos(angle) * force, y: Math.sin(angle) * force };
                this.alpha = 1; this.friction = 0.95; this.gravity = 0.15;
            }
            draw() {
                ctx.save(); ctx.globalAlpha = this.alpha;
                if(this.text) {
                    ctx.fillStyle = "#fff"; ctx.font = "bold 26px Pretendard";
                    ctx.textAlign = "center"; ctx.shadowBlur = 15; ctx.shadowColor = this.color;
                    ctx.fillText(this.text, this.x, this.y);
                } else {
                    ctx.beginPath(); ctx.arc(this.x, this.y, 2.2, 0, Math.PI * 2);
                    ctx.fillStyle = this.color; ctx.fill();
                }
                ctx.restore();
            }
            update() {
                this.velocity.x *= this.friction; this.velocity.y *= this.friction;
                this.velocity.y += this.gravity; this.x += this.velocity.x; this.y += this.velocity.y;
                this.alpha -= 0.012;
            }
        }

        function animate() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.2)'; ctx.fillRect(0, 0, canvas.width, canvas.height);
            rockets.forEach((r, i) => { if(r.alive) { r.update(); r.draw(); } else { rockets.splice(i, 1); } });
            particles.forEach((p, i) => { if (p.alpha > 0) { p.update(); p.draw(); } else { particles.splice(i, 1); } });
            requestAnimationFrame(animate);
        }
        animate();

        // [3] ë°€í”„ë ™ ì €ì¥ ë¡œì§
        function saveMeal() {
            const input = document.getElementById('meal-input');
            if(!input.value) return alert("ì‹ë‹¨ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.");
            const meals = JSON.parse(localStorage.getItem('daon_meals') || '[]');
            meals.unshift({ text: input.value, date: new Date().toLocaleString() });
            localStorage.setItem('daon_meals', JSON.stringify(meals));
            input.value = '';
            renderMeals();
        }

        function renderMeals() {
            const list = document.getElementById('meal-list');
            const meals = JSON.parse(localStorage.getItem('daon_meals') || '[]');
            list.innerHTML = meals.map(m => `
                <div class="item-card" style="font-size:12px;">
                    <small style="color:var(--accent);">${m.date}</small><br>${m.text}
                </div>
            `).join('');
        }

        // [4] ì•ˆì‹¬ ê·€ê°€ SOS (ìœ„ì¹˜ ì •ë³´)
        function startSafeReturn() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((pos) => {
                    alert(`ì•ˆì‹¬ ê·€ê°€ ì„œë¹„ìŠ¤ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.\ní˜„ì¬ ìœ„ë„: ${pos.coords.latitude}, ê²½ë„: ${pos.coords.longitude}\në³´í˜¸ìì—ê²Œ ìœ„ì¹˜ ì •ë³´ê°€ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                }, () => alert("ìœ„ì¹˜ ì •ë³´ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤."));
            }
        }

        // [5] UI ë° ê³µìœ  ë¡œì§
        function toggleDrawer(id) {
            const d = document.getElementById(id);
            const isActive = d.classList.contains('active');
            document.querySelectorAll('.drawer').forEach(el => el.classList.remove('active'));
            if(!isActive) d.classList.add('active');
            if(id === 'meal-drawer') renderMeals();
        }

        function handleLaunch() {
            const nick = document.getElementById('nickname').value || "ìˆ˜í˜¸ì";
            const msg = document.getElementById('message').value || "DAON 2025";
            const btn = document.getElementById('main-launch-btn');

            if (btn.innerText.includes("LAUNCH")) {
                for(let i=0; i<3; i++) {
                    setTimeout(() => {
                        rockets.push(new Rocket(canvas.width / 2, canvas.height, canvas.height * 0.15 + (Math.random() * 80), `hsl(${Math.random()*360}, 100%, 75%)`, msg));
                    }, i * 600);
                }
                btn.innerText = "SEND TO KAKAO (ê³µìœ )"; btn.style.background = "var(--neon-pink)";
            } else { shareKakao(nick, msg); }
        }

        function shareKakao(nick, msg) {
            const shareUrl = `${window.location.origin}${window.location.pathname}?m=${encodeURIComponent(msg)}&n=${encodeURIComponent(nick)}`;
            Kakao.Share.sendDefault({
                objectType: 'feed',
                content: {
                    title: `ğŸ† ${nick}ë‹˜ì˜ ë¶ˆê½ƒ ì„ ë¬¼`,
                    description: `"${msg}" - ì§€ê¸ˆ í´ë¦­í•´ì„œ ë°¤í•˜ëŠ˜ì„ í™•ì¸í•˜ì„¸ìš”!`,
                    imageUrl: 'https://daon-fireworks-2025.vercel.app/og-image.png',
                    link: { mobileWebUrl: shareUrl, webUrl: shareUrl }
                },
                buttons: [{ title: 'ë¶ˆê½ƒë†€ì´ ë³´ê¸°', link: { mobileWebUrl: shareUrl, webUrl: shareUrl } }]
            });
            let count = parseInt(localStorage.getItem('daon_gift_total') || '0') + 1;
            localStorage.setItem('daon_gift_total', count);
            document.getElementById('gift-count').innerText = count;
        }

        window.onload = () => {
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            document.getElementById('gift-count').innerText = localStorage.getItem('daon_gift_total') || '0';
            const urlParams = new URLSearchParams(window.location.search);
            const m = urlParams.get('m');
            if (m) { setTimeout(() => { rockets.push(new Rocket(canvas.width/2, canvas.height, canvas.height*0.2, "#00ffff", m)); }, 1200); }
        };
        window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
    </script>
</body>
</html>